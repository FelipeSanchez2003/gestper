@model List<Gestper.Models.Ticket>

@{
    Layout = null;
    var estadoFiltro = ViewBag.EstadoFiltro as string ?? "Todos";
    var estadosSelectList = ViewBag.Estados as SelectList ?? new SelectList(new List<SelectListItem>());
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Mis Tickets</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body { background-color: #f8f9fa; padding: 20px; font-family: 'Segoe UI'; }
        .badge { font-size: 0.9rem; }
        .btn { margin-right: 5px; }
        .table td, .table th { vertical-align: middle; }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="mb-4"><i class="bi bi-ticket-perforated"></i> Mis Tickets</h2>

        <div class="d-flex justify-content-between mb-4">
            <form method="get" class="d-flex">
                <label class="me-2 fw-bold">Filtrar por Estado:</label>
                <select name="estado" class="form-select me-2" style="width: 200px;" onchange="this.form.submit()">
                    <option value="Todos" selected="@(estadoFiltro == "Todos" ? "selected" : null)">Todos</option>
                    @foreach (var estado in estadosSelectList)
                    {
                        var isSelected = estadoFiltro == estado.Text;
                        <option value="@estado.Text" selected="@(isSelected ? "selected" : null)">@estado.Text</option>
                    }
                </select>
            </form>



            <a class="btn btn-success" asp-controller="Ticket" asp-action="Create">
                <i class="bi bi-plus-circle"></i> Nuevo Ticket
            </a>
        </div>

        @if (Model != null && Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Título</th>
                            <th>Descripción</th>
                            <th>Estado</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var ticket in Model)
                        {
                            <tr>
                                <td>@ticket.Titulo</td>
                                <td>@ticket.Descripcion</td>
                                <td>
                                    @{
                                        string badgeClass = ticket.Estado?.NombreEstado switch
                                        {
                                            "Abierto" => "bg-info",
                                            "En Proceso" => "bg-warning text-dark",
                                            "Resuelto" => "bg-success",
                                            "Cerrado" => "bg-secondary",
                                            _ => "bg-light text-dark"
                                        };
                                    }
                                    <span class="badge @badgeClass">@ticket.Estado?.NombreEstado</span>
                                </td>
                                <td>@ticket.FechaCreacion.ToString("dd-MM-yyyy HH:mm")</td>
                                <td>
                                    <a href="/Ticket/Details/@ticket.IdTicket" class="btn btn-sm btn-info me-1">Ver</a>
                                    <a href="/Ticket/Edit/@ticket.IdTicket" class="btn btn-sm btn-warning me-1">Editar</a>
                                    <form asp-action="Delete" asp-controller="Ticket" asp-route-id="@ticket.IdTicket" method="post" style="display:inline;" onsubmit="return confirm('¿Está seguro de eliminar este ticket?');">
                                        <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
                                    </form>


                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="alert alert-info text-center mt-4">
                <i class="bi bi-info-circle"></i> No hay tickets disponibles.
            </div>
        }
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
